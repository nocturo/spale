#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS = hardening=+all

%:
	dh $@

override_dh_auto_build:
	dh_auto_build -- PREFIX=/usr SYSCONFDIR=/etc/spale
	$(MAKE) man

override_dh_auto_install:
	dh_auto_install -- DESTDIR=$(CURDIR)/debian/spale PREFIX=/usr SYSCONFDIR=/etc/spale
	install -d -m0750 $(CURDIR)/debian/spale/etc/spale
	install -d -m0750 $(CURDIR)/debian/spale/etc/spale/clients
	install -Dm0644 doc/spale.conf.example $(CURDIR)/debian/spale/etc/spale/spale.conf.example
	install -Dm0644 systemd/spale.service $(CURDIR)/debian/spale/lib/systemd/system/spale.service
	sed -i 's#/usr/local/sbin/spale#/usr/sbin/spale#g' $(CURDIR)/debian/spale/lib/systemd/system/spale.service
	install -Dm0644 build/spale.8 $(CURDIR)/debian/spale/usr/share/man/man8/spale.8
	# Python client tools in separate spale-tools package
	install -Dm0755 tools/spa_keygen.py $(CURDIR)/debian/spale-tools/usr/bin/spale-keygen
	install -Dm0755 tools/spa_send.py $(CURDIR)/debian/spale-tools/usr/bin/spale-send

override_dh_installsystemd:
	dh_installsystemd -p spale --name=spale spale.service

override_dh_auto_test:
	# no tests



